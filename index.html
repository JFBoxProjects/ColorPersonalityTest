<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Personality Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1e3a8a',
            secondary: '#f3f4f6',
            accent: '#6b7280',
            yellow: '#f59e0b',
            green: '#10b981',
            red: '#ef4444',
            blue: '#3b82f6',
          },
          animation: {
            'gradient-swirl': 'gradient-swirl 3s ease infinite',
          },
          keyframes: {
            'gradient-swirl': {
              '0%, 100%': { 'background-position': '0% 50%' },
              '50%': { 'background-position': '100% 50%' },
            },
          },
        },
      },
    }
  </script>
  <style>
    body {
      background: linear-gradient(45deg, #ef4444, #10b981, #3b82f6, #800080, #ef4444);
      background-size: 200% 200%;
      animation: gradient-swirl 3s ease infinite;
      min-height: 100vh;
      margin: 0;
    }
    .swirl-text {
      background: linear-gradient(45deg, #ef4444, #10b981, #3b82f6, #800080, #ef4444);
      background-size: 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradient-swirl 3s ease infinite;
    }
    .content-container {
      background: rgba(255, 255, 255, 0.9);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.10/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script type="text/babel">
    console.log("Script loaded, checking dependencies...");

    // Verify dependencies
    if (typeof React === 'undefined') console.error("React failed to load");
    if (typeof ReactDOM === 'undefined') console.error("ReactDOM failed to load");
    if (typeof Babel === 'undefined') console.error("Babel failed to load");
    if (typeof window.jspdf === 'undefined') console.error("jsPDF failed to load");

    const { useState, useEffect } = React;
    const { jsPDF } = window.jspdf;

    // Error Boundary Component
    function ErrorBoundary({ children }) {
      const [hasError, setHasError] = useState(false);

      useEffect(() => {
        const handleError = (error) => {
          console.error("ErrorBoundary caught an error:", error);
          setHasError(true);
        };
        window.addEventListener('error', handleError);
        return () => window.removeEventListener('error', handleError);
      }, []);

      if (hasError) {
        return (
          <div className="text-red-500 p-4 text-center">
            Something went wrong. Please check the console (F12) for details and refresh the page.
          </div>
        );
      }

      return children;
    }

    const questions = [
      { id: 1, prompt: "I am:", options: { yellow: "Encourager", green: "Deep thinker", red: "Doer", blue: "Listener" } },
      { id: 2, prompt: "I am:", options: { yellow: "Motivator", green: "Organizer", red: "Achiever", blue: "Mediator" } },
      { id: 3, prompt: "I am:", options: { yellow: "Charismatic", green: "Realistic", red: "Dynamic", blue: "Diplomatic" } },
      { id: 4, prompt: "I am:", options: { yellow: "Stimulating", green: "Systematic", red: "Decisive", blue: "Accommodating" } },
    ];

    const personalityTypes = {
      yellow: {
        type: "Promoter",
        explanation: `
          <strong>Promoter (Yellow)</strong>: As a Promoter, you thrive in dynamic, social environments where you can inspire and motivate others. Your role as a motivator drives you to encourage fun and enthusiasm, seeking attention, applause, and recognition. You value relationships and freedom, excelling as a brainstormer, encourager, and charismatic communicator. Your strengths include creativity, optimism, and articulate expression, making you adept at understanding people's aspirations and recruiting others to your vision. However, you may struggle with disorganization, impulsiveness, or appearing unrealistic or obnoxious. You focus on possibilities and relationships, preferring a stimulating, fast-paced office with a congenial atmosphere. Your decisions are spontaneous and heart-driven, and you enjoy the challenge of starting new projects. Others may see you as "Scatteriffic" or an "Adorable Flake," reflecting your energetic but sometimes unfocused nature.
        `,
      },
      green: {
        type: "Planner",
        explanation: `
          <strong>Planner (Green)</strong>: As a Planner, you are a problem-solver who values belonging and contributing to a team. Your motives center on appreciation, acceptance, and order, with a need for accuracy and security. Your strengths lie in integrity, organization, sincerity, and reliability, making you a thoughtful and practical individual. You excel at applying facts and experience to plan and solve problems, preferring an organized, functional office environment. Your communication is indirect, detailed, and factual, often favoring written messages. However, you may come across as self-righteous, perfectionistic, or critical, and can be prone to worry or moodiness. You focus on facts, tasks, and quality, with calculated, head-driven decisions. You enjoy developing systems and processes, but others might label you as "Anal Retentive" or "Nit-picky" due to your meticulous nature.
        `,
      },
      red: {
        type: "Producer",
        explanation: `
          <strong>Producer (Red)</strong>: As a Producer, you are a driven leader motivated by power and results. You seek approval, respect, and the need to be right, with a strong desire for control and leadership. Your strengths include decisiveness, confidence, competence, and vision, making you an influential doer who excels at developing concepts and achieving goals. Your communication is direct, authoritative, and logical, focusing on the bottom line without emotional embellishment. You prefer an efficient, effective, and productive office environment, thriving on the completion of tasks and winning outcomes. However, you may be perceived as domineering, selfish, or insensitive, with tendencies toward manipulation or arrogance. Your decisions are decisive and head-driven, but others might call you "Ruthless" or "Attila the Hun" due to your assertive nature.
        `,
      },
      blue: {
        type: "Peacekeeper",
        explanation: `
          <strong>Peacekeeper (Blue)</strong>: As a Peacekeeper, you are a diplomat who seeks peace and balance, valuing acceptance, respect, and independence. Your motives center on stability and contentment, with strengths in clarity, listening, diplomacy, and kindness. You are patient, moderate, and adaptable, excelling at collaborating and mediating to meet the daily concerns of people. Your communication is indirect, empathetic, and calm, though you may hesitate to speak up. You prefer a friendly, casual office with an open-door policy, enjoying involvement and relationships. However, you can be indecisive, unmotivated, or stubborn, and may feel overwhelmed under pressure. Your decisions are consultative and heart-driven, focusing on facts and relationships. Others may see you as "Ignored" or a "Softie," reflecting your gentle, accommodating demeanor.
        `,
      },
    };

    function Question({ question, rankings, setRankings }) {
      const handleRankChange = (color, value) => {
        const newRankings = { ...rankings };
        const currentQuestion = newRankings[question.id] || {};

        const colorWithValue = Object.keys(currentQuestion).find(
          key => currentQuestion[key] === parseInt(value) && key !== color
        );

        if (colorWithValue) {
          delete currentQuestion[colorWithValue];
        }

        currentQuestion[color] = parseInt(value);
        newRankings[question.id] = currentQuestion;
        setRankings(newRankings);
      };

      return (
        <div className="mb-6 p-4 border rounded-lg bg-white shadow-sm">
          <h3 className="text-lg font-semibold text-primary mb-2">Question {question.id}: {question.prompt}</h3>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {Object.entries(question.options).map(([color, text]) => (
              <div key={color} className="flex items-center space-x-2">
                <label className="flex-1 text-accent">{text}</label>
                <select
                  className="border rounded p-1 bg-white text-accent focus:ring-2 focus:ring-primary"
                  value={rankings[question.id]?.[color] || ""}
                  onChange={(e) => handleRankChange(color, e.target.value)}
                >
                  <option value="" disabled>Select</option>
                  {[1, 2, 3, 4].map(num => (
                    <option key={num} value={num}>
                      {num}
                    </option>
                  ))}
                </select>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function Results({ rankings, userName }) {
      console.log("Rendering Results, rankings:", rankings);
      const totals = { yellow: 0, green: 0, red: 0, blue: 0 };
      Object.values(rankings).forEach(question => {
        Object.entries(question).forEach(([color, rank]) => {
          totals[color] += rank;
        });
      });

      const sortedResults = Object.entries(totals)
        .map(([color, score]) => ({
          color,
          score,
          type: personalityTypes[color].type,
          explanation: personalityTypes[color].explanation,
        }))
        .sort((a, b) => b.score - a.score);

      const handleDownloadPDF = (userName) => {
        console.log("Download button clicked, generating PDF...");
        try {
          const doc = new jsPDF();
          let yPosition = 20;

          const checkPageHeight = (additionalHeight) => {
            if (yPosition + additionalHeight > 270) {
              doc.addPage();
              yPosition = 20;
            }
          };

          doc.setFontSize(14);
          doc.setTextColor(30, 58, 138);
          doc.text(`Results for: ${userName || "Anonymous"}`, 20, yPosition);
          yPosition += 10;

          doc.setFontSize(16);
          doc.text("Color Personality Test Results", 20, yPosition);
          yPosition += 10;

          doc.setFontSize(12);
          doc.setTextColor(107, 114, 128);
          doc.text("Score Totals (Higher Scores Indicate Stronger Alignment)", 20, yPosition);
          yPosition += 8;

          sortedResults.forEach(({ color, score }) => {
            doc.setFontSize(10);
            doc.text(`${color.charAt(0).toUpperCase() + color.slice(1)}: ${score} points`, 20, yPosition);
            yPosition += 6;
          });

          yPosition += 5;

          doc.setFontSize(12);
          doc.text("Personality Types and Explanations", 20, yPosition);
          yPosition += 8;

          sortedResults.forEach(({ color, type, explanation }) => {
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text(`${color.charAt(0).toUpperCase()} - ${type}`, 20, yPosition);
            yPosition += 6;

            doc.setFontSize(9);
            const splitText = doc.splitTextToSize(explanation.trim(), 170);
            splitText.forEach(line => {
              checkPageHeight(5);
              doc.text(line, 20, yPosition);
              yPosition += 5;
            });
            yPosition += 5;
          });

          doc.save(`personality_test_results_${userName || "anonymous"}.pdf`);
          console.log("PDF generated and download initiated.");
        } catch (error) {
          console.error("Error generating PDF:", error);
        }
      };

      return (
        <div className="mt-8 p-6 border rounded-lg bg-white shadow-sm">
          <h2 className="text-2xl font-bold text-primary mb-4">Your Personality Results</h2>
          <h3 className="text-xl font-semibold text-accent mb-4">Score Totals (Higher Scores Indicate Stronger Alignment)</h3>
          <ul className="space-y-2 mb-6">
            {sortedResults.map(({ color, score }) => (
              <li key={color} className="flex items-center space-x-2">
                <span className={`w-4 h-4 rounded-full bg-${color}-500`}></span>
                <span className="capitalize text-accent font-medium">{color}: {score} points</span>
              </li>
            ))}
          </ul>
          <h3 className="text-xl font-semibold text-accent mb-4">Personality Types and Explanations</h3>
          {sortedResults.map(({ color, type, explanation }) => (
            <div key={color} className="mb-6 p-4 bg-secondary rounded-lg" dangerouslySetInnerHTML={{ __html: explanation }} />
          ))}
          <button
            onClick={() => handleDownloadPDF(userName)}
            className="mt-4 px-4 py-2 bg-primary text-white rounded hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-primary"
          >
            Download Results as PDF
          </button>
        </div>
      );
    }

    function App() {
      console.log("App rendering...");
      const [rankings, setRankings] = useState({});
      const [error, setError] = useState(null);
      const [userName, setUserName] = useState("");

      const allQuestionsAnswered = Object.keys(rankings).length === questions.length &&
        questions.every(q => Object.keys(rankings[q.id] || {}).length === 4);
      console.log("allQuestionsAnswered:", allQuestionsAnswered, "rankings:", rankings);

      useEffect(() => {
        console.log("App mounted, rankings:", rankings);
      }, [rankings]);

      if (error) {
        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="max-w-3xl w-full bg-white shadow-lg rounded-lg p-6 text-red-500">
              <h1>Error: {error}</h1>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen flex flex-col items-center justify-center p-4">
          <div className="max-w-4xl w-full content-container shadow-lg rounded-lg p-8">
            <h1 className="text-4xl font-bold text-center swirl-text">Color Personality Test</h1>
            <div className="mb-8 p-4 border rounded-lg bg-white shadow-sm">
              <h2 className="text-xl font-semibold text-primary mb-2">Enter Your Name</h2>
              <input
                type="text"
                value={userName}
                onChange={(e) => setUserName(e.target.value)}
                placeholder="Enter your name"
                className="w-full p-2 border rounded mb-4 text-accent focus:ring-2 focus:ring-primary"
              />
              <p className="text-accent">Please enter your name to personalize your results. If left blank, "Anonymous" will be used.</p>
            </div>
            <div className="mb-8">
              <h2 className="text-xl font-semibold text-primary mb-2">Instructions</h2>
              <p className="text-accent">
                For each of the questions below, rank the four options from 1 to 4 based on how well they describe you:
                <ul className="list-disc ml-6 mt-2">
                  <li><strong>4</strong>: Most like you</li>
                  <li><strong>3</strong>: Next most like you</li>
                  <li><strong>2</strong>: Next most like you</li>
                  <li><strong>1</strong>: Least like you</li>
                </ul>
                Each number (1, 2, 3, 4) can only be used once per question. After completing all questions, your results will show your personality type scores (Yellow, Green, Red, Blue) in ranked order, along with their corresponding personality types and detailed explanations.
              </p>
            </div>
            <div className="mb-8 p-4 bg-secondary rounded-lg">
              <h2 className="text-xl font-semibold text-primary mb-2">Example</h2>
              <p className="text-accent mb-2">For the question "I am:", you might rank the options as follows:</p>
              <p className="text-accent">
                DRAMATIC: <span className="font-bold text-yellow-500">3</span>, 
                PRECISE: <span className="font-bold text-green-500">1</span>, 
                POWERFUL: <span className="font-bold text-red-500">4</span>, 
                ACCOMMODATING: <span className="font-bold text-blue-500">2</span>
              </p>
            </div>
            {questions.map(question => (
              <Question
                key={question.id}
                question={question}
                rankings={rankings}
                setRankings={setRankings}
              />
            ))}
            {allQuestionsAnswered && (
              <ErrorBoundary>
                <Results rankings={rankings} userName={userName} />
              </ErrorBoundary>
            )}
          </div>
        </div>
      );
    }

    try {
      console.log("Attempting to render React app...");
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        console.error("Root element not found!");
        document.body.innerHTML = '<div class="text-red-500 p-4 text-center">Error: Root element not found. Please check the HTML structure.</div>';
      } else {
        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <ErrorBoundary>
            <App />
          </ErrorBoundary>
        );
        console.log("React app rendered successfully");
      }
    } catch (e) {
      console.error("Error rendering React app:", e);
      document.body.innerHTML = '<div class="text-red-500 p-4 text-center">Error rendering app: ' + e.message + '. Please check the console (F12) for details.</div>';
    }
  </script>
</body>
</html>